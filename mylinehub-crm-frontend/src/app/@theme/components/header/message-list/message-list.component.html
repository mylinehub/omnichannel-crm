<form action="">
  <input (change)="onSendMessageFile($event)" class="form-control visuallyhidden" type="file" name="file" id="onSendMessageFile">
</form>

<div #allMessages class='allMessages' cdkDrag [(cdkDragFreeDragPosition)]="headerVariableService.messageDragPosition" cdkDragBoundary=".cdk-overlay-container">

  <div class='message-resizers'>
    <nb-card class="message-card main" accent="info">
      <nb-card-header class="message-card-header">
        <div class="message-handle" cdkDragHandle nbTooltip="move" nbTooltipPlacement="top">
          <svg width="1.5000rem" fill="currentColor" viewBox="0 0 24 24">
            <path d="M10 9h4V6h3l-5-5-5 5h3v3zm-1 1H6V7l-5 5 5 5v-3h3v-4zm14 2l-5-5v3h-3v4h3v3l5-5zm-9 3h-4v3H7l5 5 5-5h-3v-3z"></path>
            <path d="M0 0h24v24H0z" fill="none"></path>
          </svg>
        </div>
      
        <div class="message-expand" (click)="fullScreen()">
          <nb-icon icon="expand-outline" nbTooltip="full-screen" nbTooltipPlacement="top" *ngIf="!headerVariableService.messagefullScreenEnabled"></nb-icon>
          <nb-icon icon="collapse-outline" nbTooltip="collapse-screen" nbTooltipPlacement="top" *ngIf="headerVariableService.messagefullScreenEnabled"></nb-icon>
        </div>
      
        <div class="message-close" (click)="dismiss()">
          <nb-icon icon="close-square-outline" nbTooltip="close" nbTooltipPlacement="top"></nb-icon>
        </div>
        All-Messages
      </nb-card-header>
      <nb-card-body class="main">

        <div class="messageBlockContainer">
                <!-- <button class="messageContentWrapperButton"(click)="messageContentWrapperFunc()">Messages</button> -->   
                <div class = "messageContentWrapper" [style.width.%]="messageContentWrapperWidth" [style.height.%]="messageContentWrapperHeight">  
                  <div class = "mainMessageWrapper"  [style.width.%]="mainMessageWrapperWidth" [style.height.%]="mainMessageWrapperHeight">
                      <nb-card accent="info">
                        <nb-card-header>
                          <div>
                            {{ chat }}&nbsp;{{messageListDataService.currentRecord.firstName.trim()}}&nbsp;{{messageListDataService.currentRecord.lastName.trim()}}&nbsp;&nbsp;&nbsp;
                            <!-- {{ !(messageListDataService.disableChatButton) }}
                            &nbsp;&nbsp;&nbsp;&nbsp;:
                            {{ messageListDataService.currentRecord.dotClass }} -->
                            <nb-tag *ngIf="((!(messageListDataService.disableChatButton)) && (messageListDataService.currentRecord.presence=='danger'))" status="warning" appearance="filled" text="offline" size="tiny"></nb-tag>
                            <nb-tag *ngIf="((!(messageListDataService.disableChatButton)) && (messageListDataService.currentRecord.dotClass=='dotOnline') && (messageListDataService.currentRecord.presence=='success'))" status="success" appearance="filled" text="online" size="tiny"></nb-tag>
                            <nb-tag *ngIf="((!(messageListDataService.disableChatButton)) && (messageListDataService.currentRecord.dotClass=='dotInUse') && (messageListDataService.currentRecord.presence=='success'))" status="danger" appearance="filled" text="busy" size="tiny"></nb-tag>
                            <nb-tag *ngIf="((!(messageListDataService.disableChatButton)) && (messageListDataService.currentRecord.dotClass=='dotOnHold') && (messageListDataService.currentRecord.presence=='success'))" status="basic" appearance="filled" text="hold" size="tiny"></nb-tag>
                          </div>
                          <!-- &nbsp;&nbsp;
                          <button nbButton ghost status="success" nbTooltip="make-a-call" nbTooltipPlacement="top"><nb-icon icon="phone-call-outline"></nb-icon></button> -->
                        </nb-card-header>
                        <nb-card-body>
                          <div class="chat-area">
                            <span *ngFor="let data of messageListDataService.allChatData; let i = index;">
                              <div class="row">{{ data?.fromName.trim() }}</div>
                              <span *ngIf="!(data.fromExtension == messageListDataService.currentUser.extension)">
                                    <div class="message-wrapper straight">
                                        <div class="profile-picture">
                                              <nb-user size="large"
                                                       [name]="data?.fromName.trim()"
                                                       showInitials=true
                                                       [title]="data?.fromTitle.trim()"
                                                       [color]="headerVariableService.userBackgroundColor">
                                              </nb-user>
                                          </div>
                                        <div class="message-content">
                                            <p class="name">{{ data.fromName  }}</p>
                                            <span *ngFor="let messageData of data.messages; let j = index;"> 
                                              <span *ngIf="messageData.messageType == 'string'">
                                                  <span *ngFor="let line of messageData.lines; let k = index;">
                                                    <span *ngIf="line.messageSubType == 'string'">
                                                      <div class="message">{{ line.stringMessage }}</div>
                                                    </span>
                                                    <span *ngIf="line.messageSubType == 'anchor'">
                                                      <div class="message">
                                                        <span *ngFor="let line of line.anchorMessage; let l = index;"> 
                                                              <span *ngIf="!(line.includes('@'))">
                                                                &nbsp;{{ line }}
                                                              </span>
                                                              <span *ngIf="line.includes('@')">
                                                                &nbsp;<a class="mention">{{ line }}</a>
                                                              </span>
                                                        </span>
                                                      </div>
                                                    </span>
                                                 </span>
                                              </span>
                                              <span *ngIf="messageData.messageType == 'blob'">
                                                <div class="message-file" [style.cursor]="downloadCursor" (click) = "downloadMessageFile(i,j)">
                                                  <div class="icon sketch">
                                                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve">
                                                      <defs>
                                                      </defs>
                                                      <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                                                        <path d="M 77.474 17.28 L 61.526 1.332 C 60.668 0.473 59.525 0 58.311 0 H 15.742 c -2.508 0 -4.548 2.04 -4.548 4.548 v 80.904 c 0 2.508 2.04 4.548 4.548 4.548 h 58.516 c 2.508 0 4.549 -2.04 4.549 -4.548 V 20.496 C 78.807 19.281 78.333 18.138 77.474 17.28 z M 61.073 5.121 l 12.611 12.612 H 62.35 c -0.704 0 -1.276 -0.573 -1.276 -1.277 V 5.121 z M 74.258 87 H 15.742 c -0.854 0 -1.548 -0.694 -1.548 -1.548 V 4.548 C 14.194 3.694 14.888 3 15.742 3 h 42.332 v 13.456 c 0 2.358 1.918 4.277 4.276 4.277 h 13.457 v 64.719 C 75.807 86.306 75.112 87 74.258 87 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                        <path d="M 68.193 33.319 H 41.808 c -0.829 0 -1.5 -0.671 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 26.385 c 0.828 0 1.5 0.671 1.5 1.5 S 69.021 33.319 68.193 33.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                        <path d="M 34.456 33.319 H 21.807 c -0.829 0 -1.5 -0.671 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 12.649 c 0.829 0 1.5 0.671 1.5 1.5 S 35.285 33.319 34.456 33.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                        <linearGradient id="SVGID_1" gradientUnits="userSpaceOnUse" x1="21.8064" y1="19.2332" x2="42.2984" y2="19.2332">
                                                      <stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity: 1"/>
                                                      <stop offset="100%" style="stop-color:rgb(0,0,0);stop-opacity: 1"/>
                                                      </linearGradient>
                                                      <line x1="-10.246" y1="0" x2="10.246" y2="0" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: url(#SVGID_1); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) "/>
                                                        <path d="M 42.298 20.733 H 21.807 c -0.829 0 -1.5 -0.671 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 20.492 c 0.829 0 1.5 0.671 1.5 1.5 S 43.127 20.733 42.298 20.733 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                        <path d="M 68.193 44.319 H 21.807 c -0.829 0 -1.5 -0.671 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 46.387 c 0.828 0 1.5 0.671 1.5 1.5 S 69.021 44.319 68.193 44.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                        <path d="M 48.191 55.319 H 21.807 c -0.829 0 -1.5 -0.672 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 26.385 c 0.828 0 1.5 0.672 1.5 1.5 S 49.02 55.319 48.191 55.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                        <path d="M 68.193 55.319 H 55.544 c -0.828 0 -1.5 -0.672 -1.5 -1.5 s 0.672 -1.5 1.5 -1.5 h 12.649 c 0.828 0 1.5 0.672 1.5 1.5 S 69.021 55.319 68.193 55.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                        <path d="M 68.193 66.319 H 21.807 c -0.829 0 -1.5 -0.672 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 46.387 c 0.828 0 1.5 0.672 1.5 1.5 S 69.021 66.319 68.193 66.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                        <path d="M 68.193 77.319 H 55.544 c -0.828 0 -1.5 -0.672 -1.5 -1.5 s 0.672 -1.5 1.5 -1.5 h 12.649 c 0.828 0 1.5 0.672 1.5 1.5 S 69.021 77.319 68.193 77.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                      </g>
                                                      </svg>
                                                  </div>
                                                  <div class="file-info">
                                                    <div class="file-name">{{ messageData.fileName  }}.{{ messageData.blobType }}</div>
                                                    <div class="file-size">{{ messageData.fileSizeInMB  }}MB</div>
                                                  </div>
                                                </div>
                                              </span>                                      
                                            </span>
                                        </div>
                                    </div>
                              </span>
      
                              <span *ngIf="data.fromExtension == messageListDataService.currentUser.extension">
                                    <div class="message-wrapper reverse">
                                      <div class="profile-picture">
                                            <nb-user size="large"
                                                       [name]="data?.fromName.trim()"
                                                       showInitials=true
                                                       [title]="data?.fromTitle.trim()"
                                                       [color]="headerVariableService.userBackgroundColor">
                                            </nb-user>
                                      </div>
                                      <div class="message-content">
                                        <p class="name">{{ data.fromName  }}</p>
                                        <span *ngFor="let messageData of data.messages; let j = index;"> 
                                          <span *ngIf="messageData.messageType == 'string'">
                                              <span *ngFor="let line of messageData.lines; let k = index;">
                                                <span *ngIf="line.messageSubType == 'string'">
                                                  <div class="message">{{ line.stringMessage }}</div>
                                                </span>
                                                <span *ngIf="line.messageSubType == 'anchor'">
                                                  <div class="message">
                                                    <span *ngFor="let line of line.anchorMessage; let l = index;"> 
                                                        <span *ngIf="!(line.includes('@'))">
                                                          &nbsp;{{ line }}
                                                      </span>
                                                      <span *ngIf="line.includes('@')">
                                                        &nbsp;<a class="mention">{{ line }}</a>
                                                      </span>
                                                    </span>
                                                  </div>
                                                </span>
                                             </span>
                                          </span>
                                          <span *ngIf="messageData.messageType == 'blob'">
                                            <div class="message-file"  [style.cursor]="downloadCursor" (click) = "downloadMessageFile(i,j)">
                                              <div class="icon sketch">
                                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve">
                                                  <defs>
                                                  </defs>
                                                  <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
                                                    <path d="M 77.474 17.28 L 61.526 1.332 C 60.668 0.473 59.525 0 58.311 0 H 15.742 c -2.508 0 -4.548 2.04 -4.548 4.548 v 80.904 c 0 2.508 2.04 4.548 4.548 4.548 h 58.516 c 2.508 0 4.549 -2.04 4.549 -4.548 V 20.496 C 78.807 19.281 78.333 18.138 77.474 17.28 z M 61.073 5.121 l 12.611 12.612 H 62.35 c -0.704 0 -1.276 -0.573 -1.276 -1.277 V 5.121 z M 74.258 87 H 15.742 c -0.854 0 -1.548 -0.694 -1.548 -1.548 V 4.548 C 14.194 3.694 14.888 3 15.742 3 h 42.332 v 13.456 c 0 2.358 1.918 4.277 4.276 4.277 h 13.457 v 64.719 C 75.807 86.306 75.112 87 74.258 87 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                    <path d="M 68.193 33.319 H 41.808 c -0.829 0 -1.5 -0.671 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 26.385 c 0.828 0 1.5 0.671 1.5 1.5 S 69.021 33.319 68.193 33.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                    <path d="M 34.456 33.319 H 21.807 c -0.829 0 -1.5 -0.671 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 12.649 c 0.829 0 1.5 0.671 1.5 1.5 S 35.285 33.319 34.456 33.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                    <linearGradient id="SVGID_1" gradientUnits="userSpaceOnUse" x1="21.8064" y1="19.2332" x2="42.2984" y2="19.2332">
                                                  <stop offset="0%" style="stop-color:rgb(255,255,255);stop-opacity: 1"/>
                                                  <stop offset="100%" style="stop-color:rgb(0,0,0);stop-opacity: 1"/>
                                                  </linearGradient>
                                                  <line x1="-10.246" y1="0" x2="10.246" y2="0" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: url(#SVGID_1); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) "/>
                                                    <path d="M 42.298 20.733 H 21.807 c -0.829 0 -1.5 -0.671 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 20.492 c 0.829 0 1.5 0.671 1.5 1.5 S 43.127 20.733 42.298 20.733 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                    <path d="M 68.193 44.319 H 21.807 c -0.829 0 -1.5 -0.671 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 46.387 c 0.828 0 1.5 0.671 1.5 1.5 S 69.021 44.319 68.193 44.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                    <path d="M 48.191 55.319 H 21.807 c -0.829 0 -1.5 -0.672 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 26.385 c 0.828 0 1.5 0.672 1.5 1.5 S 49.02 55.319 48.191 55.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                    <path d="M 68.193 55.319 H 55.544 c -0.828 0 -1.5 -0.672 -1.5 -1.5 s 0.672 -1.5 1.5 -1.5 h 12.649 c 0.828 0 1.5 0.672 1.5 1.5 S 69.021 55.319 68.193 55.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                    <path d="M 68.193 66.319 H 21.807 c -0.829 0 -1.5 -0.672 -1.5 -1.5 s 0.671 -1.5 1.5 -1.5 h 46.387 c 0.828 0 1.5 0.672 1.5 1.5 S 69.021 66.319 68.193 66.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                    <path d="M 68.193 77.319 H 55.544 c -0.828 0 -1.5 -0.672 -1.5 -1.5 s 0.672 -1.5 1.5 -1.5 h 12.649 c 0.828 0 1.5 0.672 1.5 1.5 S 69.021 77.319 68.193 77.319 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
                                                  </g>
                                                  </svg>
                                              </div>
                                              <div class="file-info">
                                                <div class="file-name">{{ messageData.fileName  }}.{{ messageData.blobType }}</div>
                                                <!-- <div class="file-name"><a target="_blank" [href]="URL.createObjectURL(get_blob_from_string (messageData.message, messageData.blobType))" [download]="messageData.fileName+'.'+messageData.blobType">{{ messageData.fileName  }}+'.'+{{ messageData.blobType }}</a></div> -->
                                                <div class="file-size">{{ messageData.fileSizeInMB  }}MB</div>
                                              </div>
                                            </div>
                                          </span>                                      
                                        </span>
                                    </div>
                                    </div>
                              </span>
                            </span>
                        </div>
                        </nb-card-body>
                        <nb-card-footer>
                          <div class="chat-typing-area-wrapper">
                            <div class="chat-typing-area">
                              <input id="chatInput" type="text" nbInput fullWidth fieldSize="giant" placeholder="Type your message..." [(ngModel)]="voiceRecognitionService.messageValue" class="chat-input" [disabled]="messageListDataService.disableChatButton">
                              <button nbSuffix nbButton ghost [nbTooltip]="voiceRecognitionService.listeningToolTip" (click)="startListening()" *ngIf="showTextDictate">
                                <nb-icon  [icon]="voiceRecognitionService.listeningNow ? 'mic-off-outline' : 'mic-outline'"
                                         pack="eva">
                                </nb-icon>
                              </button>
                              <!-- <input id="chatInput" type="text" nbInput fullWidth fieldSize="small" placeholder="Type your message..." [(ngModel)]="messageValue" class="chat-input" [disabled]="messageListDataService.disableChatButton"> -->
                              <!-- <input [(value)] = "messageValue" type="text" placeholder="Type your message..." class="chat-input"> -->
                              <!-- <input type="text" class="speech-input" placeholder="What's up?" name="eng-input"> -->
                              &nbsp;
                              <button nbTooltip="send-file" nbTooltipPlacement="top" class="send-button disabled" *ngIf="messageListDataService.disableChatButton">
                                  <svg class="attach-svg" height="50.0000rem" width="50.0000rem" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                                    viewBox="0 0 367.6 367.6" xml:space="preserve">
                                        <g>
                                          <g>
                                            <g>
                                              <path d="M286.5,222.4L182.9,326c-34.4,34.4-90,34.4-124.4,0l-2.8-2.8c-16.4-16.4-25.6-38.8-25.6-62.4c0-23.6,9.2-45.6,25.6-62.4
                                                l164-164c12-12,28-18.8,45.2-18.8s33.2,6.8,45.2,18.8l8.4,8.4c24.8,24.8,24.8,65.6,0,90.4l-68,68l-56,56.8
                                                c-18.8,18.8-49.2,18.8-68,0l-2.8-2.8c-18.8-18.8-18.8-49.2,0-68L231.3,80c3.2-3.2,3.2-8,0-11.2s-8-3.2-11.2,0L112.5,176
                                                c-24.8,24.8-24.8,65.6,0,90.4l2.8,2.8c12.4,12.4,28.8,18.8,45.2,18.8c16.4,0,32.8-6.4,45.2-18.8l56.4-56.4l68-68
                                                c31.2-31.2,31.2-82,0-113.2l-8.4-8.4C306.5,8,286.5,0,265.3,0c-21.2,0-41.6,8.4-56.4,23.2l-164,164c-20,19.6-30.8,46-30.8,73.6
                                                s10.8,54,30.4,73.6l2.8,2.8c20.4,20.4,46.8,30.4,73.6,30.4c26.8,0,53.2-10,73.6-30.4l103.6-103.6c3.2-3.2,3.2-8,0-11.2
                                                S289.7,219.2,286.5,222.4z"/>
                                              <path d="M327.3,181.6l-8.8,8.8c-3.2,3.2-3.2,8,0,11.2c1.6,1.6,3.6,2.4,5.6,2.4s4-0.8,5.6-2.4l8.8-8.8c3.2-3.2,3.2-8,0-11.2
                                                C335.3,178.8,330.5,178.8,327.3,181.6z"/>
                                            </g>
                                          </g>
                                        </g>
                                  </svg>
                              </button>
                              <button nbTooltip="send-file" nbTooltipPlacement="top" class="send-button" *ngIf = "!messageListDataService.disableChatButton" (click)="sendAttachedMessage()">
                                <svg class="attach-svg" height="50.0000rem" width="50.0000rem" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                                    viewBox="0 0 367.6 367.6" xml:space="preserve">
                                        <g>
                                          <g>
                                            <g>
                                              <path d="M286.5,222.4L182.9,326c-34.4,34.4-90,34.4-124.4,0l-2.8-2.8c-16.4-16.4-25.6-38.8-25.6-62.4c0-23.6,9.2-45.6,25.6-62.4
                                                l164-164c12-12,28-18.8,45.2-18.8s33.2,6.8,45.2,18.8l8.4,8.4c24.8,24.8,24.8,65.6,0,90.4l-68,68l-56,56.8
                                                c-18.8,18.8-49.2,18.8-68,0l-2.8-2.8c-18.8-18.8-18.8-49.2,0-68L231.3,80c3.2-3.2,3.2-8,0-11.2s-8-3.2-11.2,0L112.5,176
                                                c-24.8,24.8-24.8,65.6,0,90.4l2.8,2.8c12.4,12.4,28.8,18.8,45.2,18.8c16.4,0,32.8-6.4,45.2-18.8l56.4-56.4l68-68
                                                c31.2-31.2,31.2-82,0-113.2l-8.4-8.4C306.5,8,286.5,0,265.3,0c-21.2,0-41.6,8.4-56.4,23.2l-164,164c-20,19.6-30.8,46-30.8,73.6
                                                s10.8,54,30.4,73.6l2.8,2.8c20.4,20.4,46.8,30.4,73.6,30.4c26.8,0,53.2-10,73.6-30.4l103.6-103.6c3.2-3.2,3.2-8,0-11.2
                                                S289.7,219.2,286.5,222.4z"/>
                                              <path d="M327.3,181.6l-8.8,8.8c-3.2,3.2-3.2,8,0,11.2c1.6,1.6,3.6,2.4,5.6,2.4s4-0.8,5.6-2.4l8.8-8.8c3.2-3.2,3.2-8,0-11.2
                                                C335.3,178.8,330.5,178.8,327.3,181.6z"/>
                                            </g>
                                          </g>
                                        </g>
                                  </svg>
                              </button>
                              &nbsp;
                              <button nbTooltip="send-message" nbTooltipPlacement="top" class="send-button disabled" *ngIf="messageListDataService.disableChatButton">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send" viewBox="0 0 24 24">
                                  <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                                </svg>
                              </button>
                              <button id="sendMessage" type="submit" nbTooltip="send-message" nbTooltipPlacement="top" class="send-button" *ngIf = "!messageListDataService.disableChatButton" (click)="sendMessage()">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send" viewBox="0 0 24 24">
                                  <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                                </svg>
                              </button>
                            </div>
                          </div>
                        </nb-card-footer>
                      </nb-card>
                      <button id="allParticipantsButton" class="allParticipantsContentButton"(click)="allParticipantWrapperFunc()" nbButton size="small" status="danger"><nb-icon icon="person-outline"></nb-icon>All-Participants</button>
                  </div>
                  <div class = "allParticipantsWrapper"   [style.width.%]="allParticipantsWrapperWidth" [style.height.%]="allParticipantsWrapperHeight">
                    <div id = "searchAllParticipantsBox" class="searchAllParticipants">
                      <input #autoInput
                              nbInput
                              type="text"
                              class="searchAllParticipantsInput"
                              (input)="onChange()"
                              placeholder="Search Member ..."
                              [nbAutocomplete]="auto" />
    
                      <nb-autocomplete #auto (selectedChange)="onSelectionChange($event)">
    
                              <nb-option *ngFor="let option of messageListDataService.filteredOptions$ | async; let j = index;" [value]="option.extension">
                                <div class="searchParticipantOption">
                                  <!-- <nb-user size="small"
                                  [name]="option.firstName + ' '+option.lastName"
                                  title="Engineer"
                                  [showTitle]="false">
                                   </nb-user> -->
                                   <nb-user *ngIf="option.iconImageData != null"
                                            [name]="option?.firstName.trim() + ' '+option?.lastName.trim()"
                                            [onlyPicture]="false"
                                            [showInitials]="true"
                                            [picture]="'data:image/'+option?.imageType+';base64,'+option?.iconImageData | replace:'/image':''">
                                   </nb-user>
                                   <nb-user *ngIf="option.iconImageData == null"
                                            [name]="option?.firstName.trim() + ' '+option?.lastName.trim()"
                                            [onlyPicture]="false"
                                            [showInitials]="true">
                                   </nb-user>
                                  &nbsp;&nbsp;&nbsp;
                                  &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ option.extension }} - {{ option.role }}
                                </div>
                              </nb-option>
                      </nb-autocomplete>
                     </div>
    
                    <div class="listAllParticipants">
                      <nb-card>
                        <nb-card-body>
                          <div class="listAllParticipantsScroll">
                            <nb-list>
                              <nb-list-item *ngFor="let participant of messageListDataService.participants; let i = index;">
                                
                                <!-- success -->
                                <div *ngIf="(participant.dotClass=='dotOnline')  && (participant.presence=='success')" class="listAllParticipantsContainerDot" style="background-color: #00D68F;">
                                </div>
                                <!-- warning-->
                                <div *ngIf="participant.presence=='danger'" class="listAllParticipantsContainerDot" style="background-color: #FFAA00;">
                                </div>
                                <!-- danger -->
                                <div *ngIf="(participant.dotClass=='dotInUse')  && (participant.presence=='success')" class="listAllParticipantsContainerDot" style="background-color: #FF3D71;">
                                </div>
                                <!-- basic -->
                                <div *ngIf="(participant.dotClass=='dotOnHold')  && (participant.presence=='success')" class="listAllParticipantsContainerDot" style="background-color: #dde1eb;">
                                </div>

                              

                                <div class="listAllParticipantsElements">
                                  <div class="listAllParticipantsContainer">
                                    <div class="listAllParticipantsElement" (click) = "messageParticipantClicked(i)">
                                      <!-- <nb-user [name]="participant.firstName + ' '+participant.lastName " [title]="participant.role">
                                      </nb-user> -->
                                      <nb-user *ngIf="participant.iconImageData != null"
                                            [name]="participant?.firstName.trim() + ' '+participant?.lastName.trim()"
                                            [title]="participant.role"
                                            [onlyPicture]="false"
                                            [showInitials]="true"
                                            [picture]="'data:image/'+participant?.imageType+';base64,'+participant?.iconImageData | replace:'/image':''">
                                      </nb-user>
                                      <nb-user *ngIf="participant.iconImageData == null"
                                            [name]="participant?.firstName.trim() + ' '+participant?.lastName.trim()"
                                            [title]="participant.role"
                                            [onlyPicture]="false"
                                            [showInitials]="true">
                                      </nb-user>
                                    </div>
                                  </div>
                                  <div class="listAllParticipantsActions">
                                    <div class="allParticipantsButtons">
                                      <!-- <button class="listAllParticipantsAction" nbButton ghost status="info" nbTooltip="share-file" nbTooltipPlacement="top"  (click)="shareFile(i)"><nb-icon icon="upload-outline"></nb-icon></button> -->
                                      <button class="listAllParticipantsAction" nbButton ghost status="warning" nbTooltip="share-screen" nbTooltipPlacement="top"  (click)="shareScreen(i)"><i class="fas fa-expand"></i></button>
                                      <button class="listAllParticipantsAction" nbButton ghost status="danger" nbTooltip="delete-chat" nbTooltipPlacement="top"  (click)="clearSingleChat(i)"><nb-icon icon="trash-2-outline"></nb-icon></button>
                                      <button class="listAllParticipantsAction" nbButton ghost status="success" nbTooltip="make-a-call" nbTooltipPlacement="top" (click)="makeACallToParticipant(i)"><nb-icon icon="phone-call-outline"></nb-icon></button>
                                      <div class="allParticipantsBadge">
                                        <button nbButton size="tiny" status="success" *ngIf = "participant.badgeText != 0">{{ participant.badgeText }}+</button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                
                              </nb-list-item>
                            </nb-list>
                          </div>
                        </nb-card-body>
                      </nb-card>
                    </div>
                    <div class="clearAllParticipants">
                      <button id="clearAllButton" class="clearAllButton" nbButton status="danger"  (click)="clearAllChats()"><nb-icon icon="trash-2-outline"></nb-icon>{{ clearAll }}</button>
                    </div>
                  </div>   
                  <button id="participantDataButton" class="eachParticipantDataButton"(click)="participantDataFunc()" nbButton size="small" status="danger"><nb-icon icon="clipboard-outline"></nb-icon>Participant-Data</button>
                </div>  
                <div class = "participantData"   [style.width.%]="participantDataWidth" [style.height.%]="participantDataHeight">
                
                      <div id="participantDataWrapper" class="participantDataWrapper">

                          <div class="participantDataWrapperImage">
                            <img  class="participantImage" [src]= "currentPic" alt="not found"    [style.width.%]="participantImageWidth" [style.height.%]="participantImageHeight">
                          </div>
                          
                          <div class="participantDataWrapperData">
                              <div class="dataLineLeft">
                                <p style="text-align:left;">
                                  <span style="font-size:1.7rem">&nbsp;{{ messageListDataService.currentRecord.firstName.trim() }}<span>&nbsp;</span>{{ messageListDataService.currentRecord.lastName.trim() }}</span>
                                  <br><br>  
                                  <span style="font-size:0.8rem">&nbsp;&nbsp;&nbsp;Phone Number&nbsp;: {{  messageListDataService.currentRecord.phonenumber }}</span>
                                  <br>
                                  <span style="font-size:0.8rem"v>&nbsp;&nbsp;&nbsp;Department&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: {{  messageListDataService.currentRecord.departmentName }}</span>
                                  <br>
                                  <span style="font-size:0.8rem">&nbsp;&nbsp;&nbsp;Pesel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: {{  messageListDataService.currentRecord.pesel }}</span>
                                </p>           
                              </div>
                              <div class="dataLineRight">
                                <p style="text-align:left;">
                                  <span style="font-size:1.7rem">&nbsp;</span>
                                  <br><br>
                                  <span style="font-size:0.8rem">&nbsp;&nbsp;&nbsp;Extension&nbsp;&nbsp;&nbsp;&nbsp;: {{  messageListDataService.currentRecord.extension }}</span>
                                  <br>
                                  <span style="font-size:0.8rem"v>&nbsp;&nbsp;&nbsp;Role&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: {{  messageListDataService.currentRecord.role }}</span>
                                  <br>
                                  <span style="font-size:0.8rem">&nbsp;&nbsp;&nbsp;Gender&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: {{  messageListDataService.currentRecord.sex }}</span>
                                </p> 
                              </div>
                              
                            </div>
                        </div>
                </div>
         </div>
      </nb-card-body>
    </nb-card>

    <div class='message-resizer message-bottom-left'></div>
    <div class='message-resizer message-bottom-right'></div>
  </div>
  
</div>