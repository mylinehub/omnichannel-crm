  <form enctype="multipart/form-data">
    <fieldset>
      <div class="form-group visuallyhidden">
        <div>
          <input id="upload-files" type="file" (change)="onUploadFiles($event.target.files)" name="files" multiple class="form-control" />
        </div>
      </div>
    </fieldset>
  </form>
  
  <div class="row" >
    <div class="col-lg-12">
      <nb-accordion>
        
        <nb-accordion-item *ngIf="doNotShowUploadDownloadFeatures">
            <nb-accordion-item-header>üì± WhatsApp Storage Instructions</nb-accordion-item-header>
            <nb-accordion-item-body>
                <p>Follow these guidelines to efficiently manage WhatsApp media:</p>

                <ul style="list-style-type: none; padding-left: 0;">
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">üëÅÔ∏è This page is view-only for WhatsApp media.</li>
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">üì≤ Media sent via WhatsApp chats appears here automatically.</li>
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">üö´ Folder creation is not allowed.</li>
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">‚¨ÜÔ∏è File uploads are disabled.</li>
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">üìÇ Folders are auto-generated by WhatsApp phone number and date.</li>
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">üóÇÔ∏è One initial folder is always created automatically.</li>
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">‚ö†Ô∏è No manual actions are permitted on this page.</li>
                </ul>
            </nb-accordion-item-body>
            </nb-accordion-item>


          <nb-accordion-item *ngIf="!doNotShowUploadDownloadFeatures">
            <nb-accordion-item-header>üóÉÔ∏è File Storage Instructions</nb-accordion-item-header>
            <nb-accordion-item-body>
                <p>
                üìå Each folder requires an image upload; folders cannot be created without one.<br><br>
                CRM members should follow these guidelines to manage internal file storage efficiently:
                </p>

                <ul style="list-style-type: none; padding-left: 0;">
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">‚úÖ Upload and download all types of documents with ease.</li>
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">üìÅ Store media files and organize business documents.</li>
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">‚öñÔ∏è Free-tier includes storage and file transfer limits.</li>
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">üìû Contact us if you need more storage or bandwidth.</li>
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">üõ†Ô∏è Custom development available to meet your requirements.</li>
                </ul>
            </nb-accordion-item-body>
            </nb-accordion-item>


        <nb-accordion-item>
            <nb-accordion-item-header>üìû Contact Support</nb-accordion-item-header>
            <nb-accordion-item-body>
              <ul style="list-style-type: none; padding-left: 0;">
                <li style="padding-bottom: 0.6rem; padding-left: 0.6rem;">
                  <p><strong>Need help?</strong> Click the following 
                    <a [href]="whatsAppSupportlink" target="_blank" rel="noopener">support link</a> 
                    to connect with us via WhatsApp.
                  </p>
                </li>
              </ul>
              
            </nb-accordion-item-body>
          </nb-accordion-item>
        </nb-accordion>
    </div>
</div>
<br>


   <div class="row">
    <div class="col-lg-12">
      <nb-card class="transformNbCardSummaryGraphHeightAdjustment">
        <nb-card-header>
          <div class="row">
            <div class="col-lg-7">  
              üì¶ Organization Storage (MB)
            </div>
            <div id="bulkUploadButton" class="col-lg-5">
              <div class="d-flex align-items-center">
                <div style="text-align: center;" class="container">
                  <!-- <button class="notOnMobile" nbButton shape="round" size="small" status="success" (click)="bulkUpload()">Bulk Upload</button>   -->
                </div>
              </div>
            </div>
          </div>
  
        </nb-card-header>
        <nb-card-body class="transformNbCardSummaryGraphBodyAdjustment">
          <div class="row transformDownTo70">
              <ngx-charts-advanced-pie-chart
                  [scheme]="colorScheme"
                  [results]="single"
                  [valueFormatting]="formatValue"
                  [view]="view"
                  [gradient]="gradient" >
              </ngx-charts-advanced-pie-chart>
          </div>
        </nb-card-body>
      </nb-card>
     </div>  
  </div>

  
<!-- Folders Card -->
<nb-card>
    <nb-card-header>
        <b>Folders</b>  :<span>&nbsp;<b style ="color:accent">{{ fileStorageService.currentFolderSize }}</b></span>
    </nb-card-header>
    <nb-card-body>
      <div>
        <div *ngIf="fileStorageService.currentCategory == 'none' && fileStorageService.currentFolderSize != 0"><mark>No folder selected</mark></div>
        <div *ngIf="fileStorageService.currentCategory != 'none'">
            <button *ngIf="fileStorageService.showBackButton" nbButton nbTooltip="go-to-previous-folder" shape="semi-round" status="info" size="tiny" (click)="goToPreviousFolder()"><nb-icon icon="arrow-back-outline"></nb-icon>back</button>
            &nbsp;&nbsp; <span class="notOnMobile">Current Selection : &nbsp;</span>
            <i>
                <span class="upperPath" *ngFor="let item of fileStorageService.folderLadder; let k = index;">
                    <span class="upperPathItem" (click)="folderLadderClicked(k)">{{ item }}</span><span>&nbsp;/&nbsp;</span>
                </span>
            </i>
            &nbsp;
        </div>
        <br>
        <nb-card class="folderManagementCard">
            <nb-card-body>
                <nb-actions [size]="folderManagementActionSize" *ngIf="!doNotShowUploadDownloadFeatures">
                    <nb-action  style="cursor: pointer;" (click)="createCategory()" nbTooltip="create-new-category"><nb-action icon="plus-outline"></nb-action>Create</nb-action>
                    <nb-action  style="cursor: pointer;" (click)="updateCategory()" [nbTooltip] ="'update-'+fileStorageService.currentCategory.name" *ngIf="fileStorageService.currentCategory != 'none'"><nb-action icon="edit-2-outline"></nb-action>Update</nb-action>
                    <nb-action  style="cursor: pointer;" (click)="deleteCategory()" [nbTooltip] ="'delete-'+fileStorageService.currentCategory.name" *ngIf="fileStorageService.currentCategory != 'none'"><nb-action icon="trash-2-outline"></nb-action>Delete</nb-action>
                </nb-actions>
            </nb-card-body>
        </nb-card>
      </div>  
      <div>
        <nb-card class="allFoldersCard" style="max-height: 12rem;">
            <nb-card-body>
                <div *ngIf="fileStorageService.currentFolderSize == 0"><mark>No folder created</mark></div>
                <div *ngIf="fileStorageService.currentFolderSize != 0">
                    <div class="row">
                        <div class="col-6 col-sm-4 col-md-4 col-lg-2" *ngFor="let folder of fileStorageService.allFolders; let i = index;">
                            <div class="folder-container" (click)="folderIsClicked(i)">
                                <div class="folder-text">
                                <div class="folder-text-inner">
                                    &nbsp;
                                    {{
                                    (folder.name.substring(folder.name.lastIndexOf('/') + 1).length > folderMaxInteger)
                                        ? (folder.name.substring(folder.name.lastIndexOf('/') + 1) | slice: 0:folderMaxInteger) + '...'
                                        : (folder.name.substring(folder.name.lastIndexOf('/') + 1))
                                    }}
                                </div>
                                </div>
                                <div class="folder-image">
                                <img
                                    style="height: 100%; width: 100%;"
                                    [src]="'data:image/' + folder?.iconImageType + ';base64,' + folder?.iconImageByteData | replace:'/image':''"
                                />
                                </div>
                            </div>
                            </div>

                    </div>
                </div>
            </nb-card-body>
        </nb-card>
      </div>
    </nb-card-body>
</nb-card>

<!-- Files Card -->
<nb-card>
    <nb-card-header style="padding-bottom:0rem;">
        <div class="row">
            <div class="col-lg-7 col-md-7 col-sm-12" style="padding-bottom:1rem;">
                <b>Files</b>  :<span>&nbsp;<b style ="color:accent">{{ fileStorageService.currentFileSize }}</b></span>

                <span *ngIf="!doNotShowUploadDownloadFeatures">&nbsp;&nbsp;
                    <button nbButton size="tiny" outline status="warning" (click)="showUploadStatus()" *ngIf="fileStorageService.fileUploadStatus.status != 'done'">
                        Upload Status
                    </button>
                </span>
                <span *ngIf="!doNotShowUploadDownloadFeatures">&nbsp;&nbsp;
                    <button nbButton size="tiny" outline status="warning" (click)="showDownloadStatus()" *ngIf="fileStorageService.multipleFileDownloadStatus.status != 'done'">
                        Download Status
                    </button>
                </span> 
            </div>

            <div class="col-lg-5 col-md-5 col-sm-12" style="padding-bottom:1rem;" *ngIf="(fileStorageService.bulkDownload || fileStorageService.bulkDelete) && !doNotShowUploadDownloadFeatures">

                <button nbButton size="tiny" outline status="success" (click)="bulkDownload()" *ngIf="fileStorageService.bulkDownload && fileStorageService.multipleFileDownloadStatus.status == 'done'">
                        Bulk Download
                </button>
                <button nbButton size="tiny" outline status="success" (click)="bulkDelete()" *ngIf="fileStorageService.bulkDelete && fileStorageService.multipleFileDownloadStatus.status == 'done'">
                        Bulk Delete
                </button>

            </div>
        </div>
    </nb-card-header>
    <nb-card-body style="padding-top:0rem;">
     <div *ngIf="fileStorageService.currentCategory == 'none' && fileStorageService.currentFolderSize == 0"><mark>Create folder to upload files</mark></div>
     <div *ngIf="fileStorageService.currentCategory == 'none' && fileStorageService.currentFolderSize != 0"><mark>No folder selected, first select to view / upload files</mark></div>
     <div *ngIf="fileStorageService.currentCategory != 'none'">
        <div>
            <div *ngIf="fileStorageService.currentFile!= 'none'">Current Selection : &nbsp;<i><u>{{fileStorageService.currentFile.name}}</u></i>&nbsp;</div>
            <div *ngIf="fileStorageService.currentFileSize == 0"><mark>No file uploaded</mark></div>
            <br>
            <nb-card class="fileManagementCard">
                <nb-card-body>
                    <nb-actions [size]="fileManagementActionSize" *ngIf="!doNotShowUploadDownloadFeatures">
                        <nb-action style="cursor: pointer;" (click)="uploadFiles()"><nb-action icon="plus-circle-outline" nbTooltip="upload-files"></nb-action>Upload-Multiple</nb-action>
                    </nb-actions>
                </nb-card-body>
            </nb-card>
          </div>  
          <div>

            <div class="file-header">
                <div class="file-left-header">
                    <div class="d-flex justify-content-center align-items-center">
                        <h6 class="fileTableHeader">Name</h6>
                    </div>
                </div>

                <div class="file-left-size-header notOnMobile">
                    <div class="d-flex justify-content-center align-items-center">
                        <h6 class="fileTableHeader">Size</h6>
                    </div>
                </div>

                <div class="file-middle-header notOnMobile">
                    <div class="d-flex justify-content-center align-items-center">
                        <h6 class="fileTableHeader">Type</h6>
                    </div>
                </div>

                <div class="file-right-header" *ngIf="!doNotShowUploadDownloadFeatures">
                    <div class="d-flex justify-content-center align-items-center">
                        <h6 class="fileTableHeader">Action</h6> 
                    </div>
                </div>
            </div>
            <br>
            <div class="file-search fileTableSearch">

                <div class="file-left-search">
                    <input id="searchName" (input)="onSearchChange()" type="text" nbInput fullWidth shape="round" placeholder="Search Name" [(ngModel)]="fileStorageService.searchFileNameString">
                </div>

                <div class="file-left-size-search notOnMobile">
                    <input status="danger" type="text" fullWidth nbInput placeholder="‚úò Search ‚úò" disabled>
                </div>

                <div class="file-middle-search notOnMobile">
                    <input id="searchType" (input)="onSearchChange()" type="text" nbInput fullWidth shape="round" placeholder="Search Type" [(ngModel)]="fileStorageService.searchFileTypeString">
                </div>

                <div class="file-right-search" *ngIf="!doNotShowUploadDownloadFeatures">
                    <div class="file-right-inside-search">
                        <!-- <input status="danger" type="text" nbInput placeholder="‚úò Cannot Search ‚úò" disabled> -->
                        <nb-checkbox size="large" class="select-all-checkbox" (checkedChange)="toggleMultipleFileCheckBox()" [(ngModel)]="fileStorageService.tickMarkAll"><span class="notOnMobile">&nbsp;</span>Select All</nb-checkbox>
                    </div>
                </div>
            </div>
            <br>
            <nb-card class="fileListCard" style="max-height: 30rem;">
                <nb-card-body>
                        <div class="file" [ngClass]="j % 2 === 0 ? 'file-bg-2' : 'file-bg-1'" *ngFor="let file of fileStorageService.filteredOptionsList; let j = index;" (click)="fileIsClicked(j)">

                            <div class="file-left-icon notOnMobile">
                                <!-- <nb-badge [text]="j + 1" status="warning" outline class="file-left-icon-badge"></nb-badge> -->
                                <button nbButton outline status="warning" class="file-left-icon-button">{{ j+1 }}</button>
                                <!-- <div class="file-left-icon-inner"> 
                                </div> -->
                            </div>

                            <div class="file-left">
                                <div class="file-left-inner"> 
                                    <div class="row">
                                        <span class="notOnMobile">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                        <span *ngIf="itsMobile">{{ j+1 }}.&nbsp;</span>
                                        {{ (file.name.length>fileMaxInteger)? (file.name | slice:0:(fileMaxInteger-7))+'...'+(file.name | slice:(file.name.length - 7):file.name.length):(file.name) }}
                                    </div>

                                    <div class="row mobileFileRow" *ngIf="itsMobile">
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Size:&nbsp;{{ file.size }}MB
                                    </div>

                                </div>
                            </div>

                            <div class="file-left-size notOnMobile">
                                <div class="file-left-size-inner"> 
                                    &nbsp; {{ file.size }}MB
                                </div>
                            </div>


                            <div class="file-middle notOnMobile">
                                <div class="file-middle-inner">
                                    <!-- <span *ngIf="file.type != null && file.type != ''">&nbsp; {{ (file.type.length>fileMaxInteger)? (file.type | slice:0:fileMaxInteger)+'...':(file.type) }}</span> -->
                                    <span *ngIf="file.type != null && file.type != ''">&nbsp; {{(file.type.substring(file.type.lastIndexOf("/")+1,file.type.length).length>fileTypeMaxInteger)? (file.type.substring(file.type.lastIndexOf("/")+1,file.type.length) | slice:0:fileTypeMaxInteger)+'...':(file.type.substring(file.type.lastIndexOf("/")+1,file.type.length)) }}</span>
                                    
                                    <span *ngIf="file.type == null || file.type == ''">&nbsp; N/A</span>
                                </div>
                            </div>

                            <div class="file-right" *ngIf="!doNotShowUploadDownloadFeatures">
                                <div class="d-flex justify-content-center align-items-center">
                                    <div class="file-right-inner-above"  *ngIf="fileStorageService.filteredOptionsList[j].status == 'done'">
                                        <span class="notOnMobile">
                                            <nb-checkbox (checkedChange)="toggleSingleFileCheckBox(file,j)" [(ngModel)]="fileStorageService.filteredOptionsList[j].tickMark"></nb-checkbox>
                                            &nbsp;
                                        </span>
                                        <button class="individualDownloadButton"nbButton nbTooltip="download-file" ghost status="warning" (click)="fileDownload(file.name,file.type,j)"><nb-icon icon="download-outline"></nb-icon></button>
                                        <button class="individualDeleteButton" nbButton nbTooltip="delete-file" ghost status="danger" (click)="fileDelete(file.name,file.type,j)"><nb-icon icon="trash-2-outline"></nb-icon></button>    
                                    </div>
                                    <div class="file-right-inner-down"  *ngIf="fileStorageService.filteredOptionsList[j].status != 'done'">
                                        <br>
                                        <span>
                                            <nb-progress-bar style="width:50%" [value]="fileStorageService.filteredOptionsList[j].percent" [status]="fileStorageService.filteredOptionsList[j].requestType" [displayValue]="true" size="tiny"></nb-progress-bar>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                </nb-card-body>
            </nb-card>
          </div>
     </div>
      
    </nb-card-body>
  </nb-card>