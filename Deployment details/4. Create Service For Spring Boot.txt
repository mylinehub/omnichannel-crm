
Step 0 â€” Pre-Requisite (FIX Sudo Access For Scripts)
sudo systemctl restart sshdsudo visudo -f /etc/sudoers.d/mylinehub

add the below lines
ubuntu ALL=(ALL) NOPASSWD:ALL

and don't forget to restart sshd
sudo systemctl restart sshd



Step 1 â€” Create a service
sudo nano /etc/systemd/system/mylinehub-backend.service
cd /home/ubuntu/ 
sudo touch crm-output.log (Create empty file)
sudo touch crm-error.log  (Create empty file)


Copy paste below



[Unit]
Description=Mylinehub Backend Java REST Service
[Service]
User=ubuntu
# The configuration file application.properties should be here:
#change this to your workspace
WorkingDirectory=/home/ubuntu
#path to executable. 
#executable is a bash script which calls jar file 
ExecStart=/home/ubuntu/start-spring.sh
ExecStop=/home/ubuntu/stop-spring.sh
StandardOutput=file:crm-output.log
StandardError=file:crm-error.log
SuccessExitStatus=143
TimeoutStopSec=10
Restart=on-failure
RestartSec=5
[Install]
WantedBy=multi-user.target




Create Start script
sudo nano /home/ubuntu/start-spring.sh

Copy paste below in above file:
#!/bin/bash
#sudo java -Xms3G -Xmx5G -jar "/home/ubuntu/crm.jar"
sudo java -Dcom.sun.management.jmxremote \
     -Dcom.sun.management.jmxremote.port=1099 \
     -Dcom.sun.management.jmxremote.rmi.port=1099 \
     -Dcom.sun.management.jmxremote.authenticate=false \
     -Dcom.sun.management.jmxremote.ssl=false \
     -Xms3G -Xmx5G -jar "/home/ubuntu/crm.jar"


Create Stop script
sudo nano /home/ubuntu/stop-spring.sh

OLD: Copy paste below in above file:
#!/bin/bash
sudo kill -9 $(lsof -ti :8080)


New:
#!/bin/bash
PORT=8080

# Find PID of process using port 8080
PID=$(sudo lsof -ti :$PORT)

if [ -z "$PID" ]; then
  echo "âŒ No Spring Boot app running on port $PORT"
  exit 0
fi

echo "ğŸ›‘ Sending SIGTERM to process $PID for graceful shutdown..."
sudo kill -15 $PID

# Wait up to 20 seconds for graceful shutdown
for i in {1..40}; do
  if ps -p $PID > /dev/null; then
    echo "â³ Waiting for app to stop... ($i sec)"
    sleep 1
  else
    echo "âœ… App stopped gracefully."
    exit 0
  fi
done

echo "âš ï¸ App did not stop in time, forcing shutdown..."
sudo kill -9 $PID
echo "ğŸ’€ Forced stop completed."




Step 3 - Verify that the script file is executable:
sudo chmod +x /home/ubuntu/start-spring.sh
sudo chmod +x /home/ubuntu/stop-spring.sh

sudo systemctl daemon-reload
sudo systemctl enable mylinehub-backend.service
sudo systemctl start mylinehub-backend
sudo systemctl stop mylinehub-backend
sudo systemctl status mylinehub-backend

sudo systemctl stopmylinehub-backend && sudo journalctl -u mylinehub-backend -f


Step 4 â€” Setup Logging
sudo journalctl --unit=mylinehub-backend

See realtime logs usingÂ -fÂ option.
UseÂ -n <# of lines> to view specified number of lines of log
sudo journalctl -f -n 1000 -u mylinehub-backend

Tail the live log usingÂ -fÂ option
sudo journalctl -f -u mylinehub-backend

See Logs After specific Time
sudo journalctl -f -u mylinehub-backend --since "2025-09-26 15:40:00"

Stop the service
sudo systemctl stop mylinehub-backend
